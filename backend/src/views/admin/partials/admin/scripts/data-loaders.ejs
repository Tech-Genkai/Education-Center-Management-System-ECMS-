<script>
    /**
     * Data Loading Functions
     * Contains: loadClasses, loadSubjects functions
     */

    // Load Classes function
    window.loadClasses = async function() {
        try {
            const response = await fetch('/api/classes', {
                credentials: 'include'
            });
            const data = await response.json();
            const tbody = document.getElementById('classesTableBody');
            
            if (data.classes && data.classes.length > 0) {
                tbody.innerHTML = data.classes.map(cls => {
                    const teacherName = cls.classTeacher ? `${cls.classTeacher.firstName} ${cls.classTeacher.lastName}` : 'N/A';
                    return `
                    <tr class="border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                        <td class="py-3 px-4 text-sm text-gray-900 dark:text-white">${cls.className || 'N/A'}</td>
                        <td class="py-3 px-4 text-sm text-gray-600 dark:text-gray-400">${cls.classCode || 'N/A'}</td>
                        <td class="py-3 px-4 text-sm text-gray-600 dark:text-gray-400">${cls.academicYear || 'N/A'}</td>
                        <td class="py-3 px-4 text-sm text-gray-600 dark:text-gray-400">${teacherName}</td>
                        <td class="py-3 px-4 text-center">
                            <div class="flex items-center justify-center space-x-2">
                                <button onclick="editClass('${cls._id}')" 
                                        class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 text-sm font-medium" 
                                        title="Edit">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                    </svg>
                                </button>
                                <button onclick="deleteClass('${cls._id}')" 
                                        class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 text-sm font-medium" 
                                        title="Delete">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                }).join('');
            } else {
                tbody.innerHTML = '<tr><td colspan="5" class="py-8 text-center text-gray-500 dark:text-gray-400">No classes found</td></tr>';
            }
        } catch (error) {
            console.error('Error loading classes:', error);
            document.getElementById('classesTableBody').innerHTML = '<tr><td colspan="5" class="py-8 text-center text-red-500">Error loading classes</td></tr>';
        }
    };

    // Load Subjects function
    window.loadSubjects = async function() {
        try {
            const response = await fetch('/api/subjects', {
                credentials: 'include'
            });
            const data = await response.json();
            const tbody = document.getElementById('subjectsTableBody');
            
            if (data.subjects && data.subjects.length > 0) {
                tbody.innerHTML = data.subjects.map(subject => {
                    return `
                    <tr class="border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700">
                        <td class="py-3 px-4 text-sm text-gray-900 dark:text-white">${subject.subjectName || 'N/A'}</td>
                        <td class="py-3 px-4 text-sm text-gray-600 dark:text-gray-400">${subject.subjectCode || 'N/A'}</td>
                        <td class="py-3 px-4 text-sm text-gray-600 dark:text-gray-400">${subject.credits || 'N/A'}</td>
                        <td class="py-3 px-4 text-center">
                            <div class="flex items-center justify-center space-x-2">
                                <button onclick="editSubject('${subject._id}')" 
                                        class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 text-sm font-medium" 
                                        title="Edit">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                                    </svg>
                                </button>
                                <button onclick="deleteSubject('${subject._id}')" 
                                        class="text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300 text-sm font-medium" 
                                        title="Delete">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                }).join('');
            } else {
                tbody.innerHTML = '<tr><td colspan="4" class="py-8 text-center text-gray-500 dark:text-gray-400">No subjects found</td></tr>';
            }
        } catch (error) {
            console.error('Error loading subjects:', error);
            document.getElementById('subjectsTableBody').innerHTML = '<tr><td colspan="4" class="py-8 text-center text-red-500">Error loading subjects</td></tr>';
        }
    };
</script>
